"use strict";(self.webpackChunkSUN_crm=self.webpackChunkSUN_crm||[]).push([[185],{84268:(e,a,s)=>{s.d(a,{A:()=>n});s(65043);var t=s(50289),l=s(33307),o=s(70579);const n=e=>{let{label:a,name:s,required:n,required_text:i,warning:r}=e;return(0,o.jsx)(t.A.Item,{label:r?(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{children:a}),(0,o.jsx)("br",{}),(0,o.jsx)("p",{children:r})]}):(0,o.jsx)("div",{children:a}),name:s,rules:[{required:n,message:i}],children:(0,o.jsx)(l.A,{})})}},79185:(e,a,s)=>{s.r(a),s.d(a,{default:()=>j});var t=s(65043),l=s(50289),o=s(48193),n=s(47419),i=s(11645),r=s(94406),d=s(22895),u=s(89421),c=s(82907),m=s(59888),v=s(92528),p=s(73216),h=s(14556),g=s(36213),f=s(84268),A=s(59488),x=s(70579);const y={name:"",slotId:null,imageId:[]},j=()=>{const[e]=l.A.useForm(),a=(0,p.Zp)(),{editId:s}=(0,h.d4)((e=>e.editData)),j=(0,h.wA)(),[I,S]=(0,t.useState)([]),[b,w]=(0,t.useState)(null),{data:F,refetch:D}=(0,c.useQuery)("get-slot",(()=>m.A.getData("/Slot")),{enabled:!1}),{mutate:E,data:L,isLoading:V,isSuccess:C}=(0,c.useMutation)((e=>{let{url:a,formData:s}=e;return m.A.postData(a,s)}),{onSuccess:()=>{o.Ay.success("Success")},onError:e=>{for(let n in null===(a=e.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.errors){var a,s,t,l;o.Ay.error("".concat(n,": ").concat(null===(t=e.response)||void 0===t||null===(l=t.data)||void 0===l?void 0:l.errors[n]))}}}),{mutate:q,data:M,isLoading:H,isSuccess:T}=(0,c.useMutation)((e=>{let{url:a,data:s}=e;return m.A.postData(a,s)}),{onSuccess:()=>{o.Ay.success("Success")},onError:e=>{for(let a in e.response.data)o.Ay.error("".concat(a,": ").concat(e.response.data[a]))}}),{isLoading:U,data:k,refetch:N,isSuccess:O}=(0,c.useQuery)(["edit-house",s],(()=>m.A.getDataByID("/House",s)),{enabled:!1}),{mutate:_,isLoading:P,data:R,isSuccess:z}=(0,c.useMutation)((e=>{let{url:a,data:s,id:t}=e;return m.A.editData(a,s,t)}),{onSuccess:()=>{o.Ay.success("Success")},onError:e=>{for(let a in e.response.data)o.Ay.error("".concat(a,": ").concat(e.response.data[a]))}}),{mutate:J,isLoading:Q,data:B,isSuccess:W}=(0,c.useMutation)((e=>{let{url:a,data:s,id:t}=e;return m.A.editData(a,s,t)}),{onSuccess:()=>{o.Ay.success("Success")},onError:e=>{for(let a in e.response.data)o.Ay.error("".concat(a,": ").concat(e.response.data[a]))}});(0,t.useEffect)((()=>{z&&j({type:g.aT,payload:""}),(T||z)&&a("/house")}),[M,R]),(0,t.useEffect)((()=>{""!==s&&N()}),[s]),(0,t.useEffect)((()=>{""===s&&e.setFieldsValue(y),D()}),[]),(0,t.useEffect)((()=>{let a=null;var s,t;void 0!==k&&(a=[{uid:null===k||void 0===k||null===(s=k.image)||void 0===s?void 0:s.id,name:null===k||void 0===k||null===(t=k.image)||void 0===t?void 0:t.id,status:"done",url:"".concat("https://seller.human2human.uz/","/").concat(null===k||void 0===k?void 0:k.image.path)}]);if(O){var l;const s={name:null===k||void 0===k?void 0:k.name,slotId:null===k||void 0===k||null===(l=k.slot)||void 0===l?void 0:l.id,imageId:a};S(a),e.setFieldsValue(s)}}),[k]);(0,t.useEffect)((()=>{const a=JSON.parse(localStorage.getItem("myFormValues"));a&&(a.images=[],e.setFieldsValue(a));const s=()=>{localStorage.setItem("myFormValues",JSON.stringify(e.getFieldsValue()))};return window.addEventListener("beforeunload",s),()=>{localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",s)}}),[]),(0,t.useEffect)((()=>{let a=W?B:L;if(C||W){const s=[{uid:null===a||void 0===a?void 0:a.id,name:null===a||void 0===a?void 0:a.id,status:"done",url:"".concat("https://seller.human2human.uz/","/").concat(null===a||void 0===a?void 0:a.path)}];e.setFieldsValue({imageId:s}),S(s)}}),[L,B]);const Z=(0,t.useMemo)((()=>{var e;return null===F||void 0===F||null===(e=F.result)||void 0===e?void 0:e.map((e=>({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.name})))}),[F]);return(0,x.jsx)("div",{children:H||U||P||V||Q?(0,x.jsx)(v.HE,{}):(0,x.jsxs)(l.A,{form:e,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:y,onFinish:e=>{var a;const t={name:e.name,slotId:e.slotId,imageId:null===(a=I[0])||void 0===a?void 0:a.uid};O?_({url:"/House",data:t,id:s}):q({url:"/House/",data:t})},onFinishFailed:e=>{console.log("Failed:",e)},autoComplete:"off",children:[(0,x.jsxs)(n.A,{gutter:20,children:[(0,x.jsx)(i.A,{span:12,children:(0,x.jsx)(f.A,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0434\u043e\u043c",label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0434\u043e\u043c",name:"name"})}),(0,x.jsx)(i.A,{span:12,children:(0,x.jsx)(l.A.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043b\u043e\u0442",name:"slotId",rules:[{required:!0,message:"\u0412\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0441\u043b\u043e\u0442"}],wrapperCol:{span:24},children:(0,x.jsx)(r.A,{style:{width:"100%"},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u0441\u043b\u043e\u0442",optionLabelProp:"label",options:Z})})})]}),(0,x.jsx)(n.A,{gutter:20,children:(0,x.jsx)(i.A,{span:12,children:(0,x.jsx)(l.A.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0434\u043e\u043c\u0430",name:"imageId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"}],children:(0,x.jsx)(A.A,{children:(0,x.jsx)(d.A,{maxCount:1,fileList:I,listType:"picture-card",onChange:e=>{let{fileList:a}=e;const s=new FormData;0!==a.length&&(s.append("fromFile",a[0].originFileObj),O&&b?J({url:"/Image",data:s,id:b}):E({url:"/Image/",formData:s}))},onPreview:async e=>{let a=e.url;a||(a=await new Promise((a=>{const s=new FileReader;s.readAsDataURL(e.originFileObj),s.onload=()=>a(s.result)})));const s=new Image;s.src=a;const t=window.open(a);null===t||void 0===t||t.document.write(s.outerHTML)},onRemove:a=>{const s=null===a||void 0===a?void 0:a.uid;w(s),e.setFieldsValue({imageId:[]}),S([])},beforeUpload:()=>!1,children:I.length>0?"":"Upload"})})})})}),(0,x.jsx)(u.A,{type:"primary",htmlType:"submit",style:{width:"100%",marginTop:"20px"},children:O?"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})]})})}}}]);
//# sourceMappingURL=185.631d1fad.chunk.js.map